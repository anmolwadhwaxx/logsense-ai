<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Capture</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div id="container">
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" data-tab="logs">Network Logs</button>
            <button class="tab-button" data-tab="user-details">User Details</button>
            <button class="tab-button" data-tab="ai-insights">AI Insights</button>
            <button class="tab-button" data-tab="visualization">Visualization</button>
            <button class="tab-button" data-tab="settings">Settings</button>
        </div>

        <!-- Network Logs Tab -->
        <div id="logs-tab" class="tab-content active">
            <div class="quick-actions">
                <button id="clear-button">Clear Data</button>
                <button id="download-json">Download Full HAR Log</button>
            </div>
		
		<div class="collapsible-section">
			<button class="collapsible">Show Environment Info</button>
			<div class="collapsible-content env-info">
			  <pre id="env-info">Loading environment info...</pre>
			</div>
		</div>

		<!-- Session Summary Container -->
		<div class="session-summary-container">
			<h2>Session Summary</h2>
			<div id="session-summary">
				<!-- Session summary will be displayed here -->
			</div>
		</div>

		<!-- Expandable Request Details -->
		<div class="collapsible-section">
			<button class="collapsible">Show Individual Requests</button>
			<div class="collapsible-content">
				<div id="network-data">
					<!-- Individual requests will be displayed here -->
				</div>
			</div>
		</div>
        </div>

        <!-- User Details Tab -->
        <div id="user-details-tab" class="tab-content">
            <div class="user-status-indicator">
                <span id="user-status-text">No user data available</span>
                <button id="refresh-user-data">üîÑ Refresh</button>
            </div>

            <!-- User Profile Section -->
            <div class="user-section">
                <h3>üë§ User Profile</h3>
                <div class="user-profile-content">
                    <div class="user-info-grid">
                        <!-- Profile data will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Session Information -->
            <div class="user-section">
                <h3>‚è∞ Session Details</h3>
                <div class="user-session-content">
                    <div class="user-info-grid">
                        <!-- Session data will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Capabilities & Permissions -->
            <div class="user-section">
                <h3>üîê Capabilities & Permissions</h3>
                <div class="capabilities-tabs">
                    <button class="capability-tab active" data-capability="features">Feature Flags</button>
                    <button class="capability-tab" data-capability="transactions">Transaction Rights</button>
                    <button class="capability-tab" data-capability="system">System Flags</button>
                </div>
                <div id="capabilities-content">
                    <div id="features-content" class="capability-content active">
                        <div class="capability-grid">
                            <!-- Features will be populated here -->
                        </div>
                    </div>
                    <div id="transactions-content" class="capability-content">
                        <div class="capability-grid">
                            <!-- Transaction rights will be populated here -->
                        </div>
                    </div>
                    <div id="system-content" class="capability-content">
                        <div class="capability-grid">
                            <!-- System flags will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Environment Context -->
            <div class="user-section">
                <h3>üé® Environment Context</h3>
                <div class="environment-content">
                    <div id="environment-data">No environment data available.</div>
                </div>
            </div>
        </div>

        <!-- AI Insights Tab -->
        <div id="ai-insights-tab" class="tab-content">
            <div class="ai-header">
                <h2>ü§ñ AI-Powered Session Analysis</h2>
                <p class="ai-description">Intelligent insights and automated analysis of your session data</p>
            </div>

            <!-- Authentication Section -->
            <div class="ai-section">
                <h3>üîê Authentication</h3>
                <div id="auth-section" class="ai-content-area">
                    <div id="auth-form" style="display: block;">
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Username:</label>
                            <input type="text" id="auth-username" placeholder="Enter your username" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Password:</label>
                            <input type="password" id="auth-password" placeholder="Enter your password" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                        </div>
                        <button id="auth-login" class="ai-action-btn" style="width: 100%;">
                            üîì Login & Get Token
                        </button>
                    </div>
                    <div id="auth-status" style="display: none;">
                        <div class="ai-placeholder">
                            <span class="ai-placeholder-icon">‚úÖ</span>
                            <p>Authenticated successfully! Token ready for use.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="ai-actions">
                <button id="generate-summary" class="ai-action-btn primary">
                    ‚ö° Generate Smart Summary
                </button>
                <button id="analyze-performance" class="ai-action-btn">
                    üìä Analyze Performance
                </button>
                <button id="detect-issues" class="ai-action-btn">
                    üîç Detect Issues
                </button>
                <button id="summarize-logs" class="ai-action-btn">
                    üìä Summarize Logs
                </button>
                <button id="clear-analysis" class="ai-action-btn secondary">
                    üóëÔ∏è Clear Analysis
                </button>
            </div>

            <!-- AI Summary Section -->
            <div class="ai-section">
                <h3>üìã Intelligent Summary</h3>
                <div id="ai-summary-content" class="ai-content-area">
                    <div class="ai-placeholder">
                        <span class="ai-placeholder-icon">ü§ñ</span>
                        <p>Click "Generate Smart Summary" to get AI-powered insights about your session</p>
                    </div>
                </div>
            </div>

            <!-- Session Analytics Section -->
            <div class="ai-section">
                <h3>üéØ Session Analytics</h3>
                <div id="session-analytics-content" class="ai-content-area">
                    <div class="analytics-grid">
                        <div class="analytics-card">
                            <h4 id="slow-requests-title">‚è±Ô∏è Slow Requests</h4>
                            <div id="slow-requests-list" class="analytics-list">
                                <div class="analytics-placeholder">No analysis available. Generate summary first.</div>
                            </div>
                        </div>
                        <div class="analytics-card">
                            <h4>‚ùå Error Analysis</h4>
                            <div id="error-analysis-list" class="analytics-list">
                                <div class="analytics-placeholder">No analysis available. Generate summary first.</div>
                            </div>
                        </div>
                        <div class="analytics-card">
                            <h4>üìà Performance Trends</h4>
                            <div id="performance-trends" class="analytics-list">
                                <div class="analytics-placeholder">No analysis available. Generate summary first.</div>
                            </div>
                        </div>
                        <div class="analytics-card">
                            <h4>üöÄ Optimization Tips</h4>
                            <div id="optimization-tips" class="analytics-list">
                                <div class="analytics-placeholder">No analysis available. Generate summary first.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Session Health Score -->
            <div class="ai-section">
                <h3>üíØ Session Health Score</h3>
                <div id="session-health-content" class="ai-content-area">
                    <div class="health-score-container">
                        <div class="health-score-circle">
                            <span id="health-score-value">--</span>
                            <small>/ 100</small>
                        </div>
                        <div class="health-details">
                            <div id="health-breakdown" class="health-breakdown">
                                <div class="health-placeholder">Generate analysis to see health score</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Recommendations -->
            <div class="ai-section">
                <h3>üí° Smart Recommendations</h3>
                <div id="ai-recommendations-content" class="ai-content-area">
                    <div class="recommendations-list">
                        <div class="ai-placeholder">
                            <span class="ai-placeholder-icon">üí°</span>
                            <p>AI recommendations will appear here after analysis</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Log Summaries Section -->
            <div class="ai-section">
                <h3>üìä Log Summaries</h3>
                
                <!-- Time-based Search Bar -->
                <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 6px;">
                    <div style="margin-bottom: 10px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">üîç Time-based Query:</label>
                        <input type="text" id="time-query-input" placeholder="e.g., 'give me logs for last 10 mins', 'last 2 hours', 'past 30 minutes'" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                    </div>
                    <button id="parse-time-query" style="padding: 8px 16px; background: #007acc; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">
                        üïí Parse & Set Time
                    </button>
                    <div id="parsed-time-display" style="margin-top: 10px; padding: 8px; background: #e3f2fd; border-radius: 4px; display: none;">
                        <strong>Parsed Time:</strong> <span id="parsed-time-value"></span>
                    </div>
                </div>

                <!-- Environment-specific Log Summary Buttons -->
                <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 6px;">
                    <div style="margin-bottom: 10px; font-weight: 600;">üìã Summarize Logs by Environment:</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <button id="summarize-hq-logs" class="ai-action-btn" style="font-size: 12px; padding: 8px 12px;">
                            üè¢ HQ Logs
                        </button>
                        <button id="summarize-kamino-logs" class="ai-action-btn" style="font-size: 12px; padding: 8px 12px;">
                            üåä Kamino Logs
                        </button>
                        <button id="summarize-lightbridge-logs" class="ai-action-btn" style="font-size: 12px; padding: 8px 12px;">
                            üåâ LightBridge Logs
                        </button>
                        <button id="summarize-ardent-logs" class="ai-action-btn" style="font-size: 12px; padding: 8px 12px;">
                            üî• Ardent Logs
                        </button>
                    </div>
                </div>
                
                <div id="log-summaries-content" class="ai-content-area">
                    <div class="ai-placeholder">
                        <span class="ai-placeholder-icon">üìä</span>
                        <p>Enter a time query above or click "Summarize Logs" to get AI-powered log analysis</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Visualization Tab -->
        <div id="visualization-tab" class="tab-content">
            <div class="visualization-controls">
                <div class="current-site-indicator">
                    <strong>Analyzing:</strong> <span id="current-site-name">Loading...</span>
                </div>
                <div class="viz-controls-right">
                    <button id="refresh-viz">Refresh Charts</button>
                    <select id="time-range">
                        <option value="5m">Last 5 minutes</option>
                        <option value="15m">Last 15 minutes</option>
                        <option value="1h">Last hour</option>
                        <option value="all">All time</option>
                    </select>
                </div>
            </div>

            <!-- Network Timeline -->
            <div class="viz-section">
                <h3>Request Timeline</h3>
                <div id="timeline-chart" class="chart-container">
                    <canvas id="timeline-canvas"></canvas>
                </div>
            </div>

            <!-- Performance Metrics -->
            <div class="viz-section">
                <h3>Performance Overview</h3>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <h4>Total Requests</h4>
                        <span id="total-requests" class="metric-value">0</span>
                    </div>
                    <div class="metric-card">
                        <h4>Average Response Time</h4>
                        <span id="avg-response-time" class="metric-value">0ms</span>
                    </div>
                    <div class="metric-card">
                        <h4>Error Rate</h4>
                        <span id="error-rate" class="metric-value">0%</span>
                    </div>
                    <div class="metric-card">
                        <h4>Data Transferred</h4>
                        <span id="data-transferred" class="metric-value">0 KB</span>
                    </div>
                </div>
            </div>

            <!-- Request Type Distribution -->
            <div class="viz-section">
                <h3>Request Types</h3>
                <div id="request-types-chart" class="chart-container">
                    <canvas id="types-canvas"></canvas>
                </div>
            </div>

            <!-- Domain Analysis -->
            <div class="viz-section">
                <h3>Top Endpoints</h3>
                <div id="domain-chart" class="chart-container">
                    <div id="domain-list"></div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content">
            <div class="settings-section">
                <h3>Time Configuration</h3>
                <div class="form-row">
                    <label for="user-utc-offset">UTC Offset:</label>
                    <input type="text" id="user-utc-offset" value="-0700" maxlength="6" style="width:70px;">
                    <button id="set-utc-offset">Set</button>
                </div>
            </div>

            <div class="settings-section">
                <h3>Site Management</h3>
                <div class="form-row">
                    <label for="site-selector">Site:</label>
                    <select id="site-selector" style="flex: 1; min-width: 150px;"></select>
                </div>
                <div class="form-row">
                    <input type="text" id="site-input" placeholder="Enter site URL" style="flex: 1;">
                    <button id="add-site">Add Site</button>
                </div>
                <div class="form-row">
                    <label for="side-selector">Side:</label>
                    <select id="side-selector">
                        <option value="Client">Client</option>
                        <option value="Server">Server</option>
                        <option value="Other">Other</option>
                    </select>
                    <input type="text" id="custom-side" placeholder="Custom side" style="display:none;width:100px;">
                </div>
            </div>

            <div class="settings-section">
                <h3>Capture Options</h3>
                <div class="form-row">
                    <label>
                        <input type="checkbox" id="capture-responses" checked>
                        Capture Response Bodies
                    </label>
                </div>
                <div class="form-row">
                    <label>
                        <input type="checkbox" id="auto-dedupe" checked>
                        Auto-deduplicate Logon Requests
                    </label>
                </div>
                <div class="form-row">
                    <label>
                        <input type="checkbox" id="show-timing" checked>
                        Show Request Timing
                    </label>
                </div>
            </div>

            <div class="settings-section">
                <h3>Export Options</h3>
                <div class="form-row">
                    <button id="export-har">Export as HAR</button>
                    <button id="export-csv">Export Summary as CSV</button>
                </div>
                <div class="form-row">
                    <button id="import-har">Import HAR File</button>
                    <input type="file" id="har-file-input" accept=".har" style="display:none;">
                </div>
            </div>
        </div>
    </div>
    <script src="popup.js"></script>
</body>
</html>